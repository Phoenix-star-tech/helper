{% extends 'base.html' %}

{% block title %}Notifications - Mr. Helper{% endblock %}

{% block content %}
<h2>Notifications for {{ session['username'] }}</h2>

<p>Total Notifications: {{ notifications|length }}</p>
{% if notifications %}
    {% for note in notifications %}
    <div class="notification-card {% if note.is_read %}notification-read{% endif %}">
        <p>{{ note.message }}</p>
        <p><strong>Order Owner:</strong> {{ note.owner_username }}</p>

        {# Provider View #}
        {% if session['username'] != note.owner_username %}
            {% if note.approved_provider == session['username'] %}
                <button class="btn btn-success" disabled>Approved</button>
            {% elif note.approved_provider and note.approved_provider != session['username'] %}
                <button class="btn btn-danger" disabled>Rejected</button>
            {% else %}
                <form action="{{ url_for('order_accept', order_id=note.order_id) }}" method="post">
                    <button type="submit" class="btn btn-primary">Accept</button>
                </form>
            {% endif %}

        {# Owner View #}
        {% elif session['username'] == note.owner_username %}
            {% if note.approved_provider == note.from_user %}
                <button class="btn btn-secondary" disabled>Approved</button>
            {% elif not note.approved_provider %}
                <form action="{{ url_for('approve_provider', order_id=note.order_id) }}" method="post">
                    <input type="hidden" name="selected_provider" value="{{ note.from_user }}">
                    <button type="submit" class="btn btn-success">Approve</button>
                </form>
            {% else %}
                <button class="btn btn-danger" disabled>Rejected</button>
            {% endif %}
        {% endif %}

        <small>{{ note.notif_created_at }}</small>
    </div>
    {% endfor %}

{% else %}
    <p>No notifications yet.</p>
{% endif %}

<style>
.notification-card {
    background: #f4f4f4;
    padding: 15px;
    margin: 10px 0;
    border-left: 5px solid #007bff;
    border-radius: 8px;
}
.notification-read {
    opacity: 0.6;
}
.notification-card button {
    margin-top: 8px;
}
</style>
{% endblock %}
