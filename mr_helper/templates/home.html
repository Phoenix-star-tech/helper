{% extends 'base.html' %} {% block title %}Home - Mr. Helper{% endblock %} {%
block content %}
<h2>Welcome to Mr. Helper</h2>

<div class="search-container">
  <form
    action="{{ url_for('search') }}"
    method="GET"
    style="position: relative"
  >
    <input
      type="text"
      id="search-box"
      name="q"
      placeholder="Search services..."
      autocomplete="off"
      required
    />
    <button type="submit">Search</button>
    <div id="search-suggestions" class="suggestions-box"></div>
  </form>
</div>

<h3>Available Services:</h3>
<ul>
  {% for service in services %}
    <li>
      <a class="service_box" href="{{ url_for('service', service_name=service) }}">
        <img class="service_img" src="{{ url_for('static', filename='assets/' + service_images[service]) }}" alt="{{ service }}" />
        <span>{{ service }}</span>
      </a>
    </li>
  {% endfor %}
</ul>
<script>
  const searchBox = document.getElementById("search-box");
  const suggestionsBox = document.getElementById("search-suggestions");

  const placeholders = [
    "Search for House Cleaning...",
    "Search for Electrician...",
    "Search for a username...",
    "Search for a location...",
    "Search for Motor Repair...",
    "Search for Kitchen Cleaning...",
  ];

  let currentPlaceholder = 0;
  setInterval(() => {
    searchBox.setAttribute("placeholder", placeholders[currentPlaceholder]);
    currentPlaceholder = (currentPlaceholder + 1) % placeholders.length;
  }, 2000);

  searchBox.addEventListener("input", function () {
    const query = this.value;
    if (query.length === 0) {
      suggestionsBox.innerHTML = "";
      return;
    }

    fetch(`/suggest?term=${encodeURIComponent(query)}`)
      .then((res) => res.json())
      .then((suggestions) => {
        suggestionsBox.innerHTML = "";
        suggestions.forEach((item) => {
          const div = document.createElement("div");
          div.classList.add("suggestion-item");
          div.textContent = item;
          div.onclick = () => {
            searchBox.value = item;
            suggestionsBox.innerHTML = "";
          };
          suggestionsBox.appendChild(div);
        });
      });
  });

  document.addEventListener("click", (e) => {
    if (!suggestionsBox.contains(e.target) && e.target !== searchBox) {
      suggestionsBox.innerHTML = "";
    }
  });
</script>
{% endblock %}
