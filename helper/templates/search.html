{% extends 'base.html' %}
{% block title %}Search Results - Mr. Helper{% endblock %}
{% block content %}

<h2>Search Results for "{{ query }}"</h2>

<div class="search-container">
  <form action="{{ url_for('search') }}" method="GET" style="position: relative;">
    <input type="text" id="search-box" name="q" value="{{ query }}" placeholder="Search..." autocomplete="off" required>
    <button type="submit">Search</button>
    <div id="search-suggestions" class="suggestions-box"></div>
  </form>
</div>

<div class="results-container">
  {% if service_results %}
    <h3>Services</h3>
    <ul class="services-list">
      {% for service in service_results %}
        <li>
          <a href="{{ url_for('service', service_name=service.service_name) }}">
            {{ service.service_name }}
          </a>          
        </li>
      {% endfor %}
    </ul>
  {% endif %}

  {% if location_results %}
  <h3>Locations</h3>
  <ul class="location-list">
    {% for location in location_results %}
      <li>{{ location.location_name }}</li>
    {% endfor %}
  </ul>
{% endif %}

  {% if business_results %}
    <h3>Service Providers</h3>
    <ul class="business-list">
      {% for business in business_results %}
        <li>
          <a href="{{ url_for('profile', username=business.username) }}">
            <strong>{{ business.username }}</strong> - {{ business.business_type }}
<span class="location">{{ business.location }}</span>
            <span class="rating">{{
business.rating }} â˜…</span>
            <span class="price">{% if business.price %}{{ business.price }}{% else %}Not provided{% endif %}</span>
          </a>
        </li>
      {% endfor %}
    </ul>
  {% endif %}

  {% if not service_results and not business_results %}
    <p>No results found for "{{ query }}".</p>
  {% endif %}
</div>

<a class="back-link" href="{{ url_for('home') }}">Back to Home</a>

<script>
  const searchBox = document.getElementById('search-box');
  const suggestionsBox = document.getElementById('search-suggestions');

  
  const placeholders = [
    "Search for House Cleaning...",
    "Search for Electrician...",
    "Search for a username...",
    "Search for a location...",
    "Search for Motor Repair...",
    "Search for Kitchen Cleaning..."
  ];

  let currentPlaceholder = 0;
  setInterval(() => {
    searchBox.setAttribute('placeholder', placeholders[currentPlaceholder]);
    currentPlaceholder = (currentPlaceholder + 1) % placeholders.length;
  }, 2000);


searchBox.addEventListener('input', function () {
  const query = this.value;  // Get the current search query
  if (query.length === 0) {
    suggestionsBox.innerHTML = '';  // Clear suggestions when the input is empty
    return;
  }

  console.log(`Searching for: ${query}`);  // Log the current search query to check

  // Fetch suggestions based on the input
  fetch(`/suggest?term=${encodeURIComponent(query)}`)
    .then(res => res.json())  // Parse the JSON response
    .then(suggestions => {
      console.log(suggestions);  // Log the suggestions for debugging

      suggestionsBox.innerHTML = '';  // Clear previous suggestions

      // If suggestions exist, display them
      if (suggestions.length > 0) {
        suggestions.forEach(item => {
          const div = document.createElement('div');
          div.classList.add('suggestion-item');
          div.textContent = item;

          // When a suggestion is clicked, populate the search box with it
          div.onclick = () => {
            searchBox.value = item;
            suggestionsBox.innerHTML = '';  // Clear suggestions after selecting one
          };

          suggestionsBox.appendChild(div);
        });
      } else {
        suggestionsBox.innerHTML = '<div>No suggestions found</div>';  // Display if no suggestions
      }
    })
    .catch(error => {
      console.error('Error fetching suggestions:', error);  // Log any errors
      suggestionsBox.innerHTML = '<div>Error loading suggestions</div>';
    });
});

document.addEventListener('click', (e) => {
  if (!suggestionsBox.contains(e.target) && e.target !== searchBox) {
    suggestionsBox.innerHTML = '';  // Close suggestions box when clicking outside
  }
});

</script>

{% endblock %}