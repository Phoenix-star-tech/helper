{% extends 'base.html' %}
{% block title %}Admin Dashboard{% endblock %}
{% block content %}

<h2>Welcome, Admin</h2>
<h3>Delete User Accounts</h3>

<input type="text" id="searchInput" placeholder="Search by username, type, or location..." style="margin-bottom: 10px; width: 100%; padding: 8px; border-radius: 6px; border: 1px solid #ccc;">

<table id="userTable">
  <tr>
    <th>Username</th>
    <th>Type</th>
    <th>Location</th>
    <th>Action</th>
  </tr>
  {% for user in users %}
  <tr>
    <td><a href="{{ url_for('profile', username=user.username) }}" style="text-decoration: none; color: #007BFF;">
      {{ user.username }}
    </a></td>
    <td>{{ user.account_type }}</td>
    <td>{{ user.location or 'N/A' }}</td>
    <td>
      <form action="{{ url_for('delete_user', username=user.username) }}" method="POST" onsubmit="return confirm('Are you sure you want to delete {{ user.username }}?');">
        <button type="submit">Delete</button>
      </form>
    </td>
  </tr>
  {% endfor %}
</table>
<h3>Reported Users</h3>
<table>
  <tr>
    <th>Username</th>
    <th>Report Count</th>
    <th>Reasons</th>
    <th>Action</th>
  </tr>
  {% for report in reported_users %}
  <tr>
    <td><a href="{{ url_for('profile', username=report['reported_user']) }}">{{ report['reported_user'] }}</a></td>
    <td>{{ report['report_count'] }}</td>
    <td>
      <button onclick="toggleReasons('reason-{{ loop.index0 }}')">View Reasons</button>
      <div id="reasons-{{ loop.index0 }}" style="display:none; margin-top: 8px; background: #f8f9fa; padding: 10px; border-radius: 8px; border: 1px solid #ccc; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
        <ul style="margin: 0; padding-left: 20px;">
          {% for reason in report['reasons'] %}
            <li>{{ reason }}</li>
          {% endfor %}
        </ul>
      </div>      
    </td>    
    <td>
      <form action="{{ url_for('delete_user', username=report['reported_user']) }}" method="POST" onsubmit="return confirm('Are you sure you want to delete {{ report['reported_user'] }}?');">
        <button type="submit">Delete</button>
      </form>
    </td>
  </tr>
  {% endfor %}
</table>
</table>


<a href="{{ url_for('logout') }}">Logout</a>

<script>
  const searchInput = document.getElementById("searchInput");
  const table = document.getElementById("userTable");
  const rows = table.getElementsByTagName("tr");

  searchInput.addEventListener("input", function () {
    const filter = searchInput.value.toLowerCase();

    for (let i = 1; i < rows.length; i++) {
      const cells = rows[i].getElementsByTagName("td");
      let match = false;
      for (let j = 0; j < 3; j++) { // username, type, location
        if (cells[j] && cells[j].textContent.toLowerCase().includes(filter)) {
          match = true;
          break;
        }
      }
      rows[i].style.display = match ? "" : "none";
    }
  });
</script>
<script>
  function toggleReasons(id) {
    const reasonDiv = document.getElementById(id);
    if (reasonDiv) {
      reasonDiv.style.display = reasonDiv.style.display === 'none' ? 'block' : 'none';
    } else {
      alert("Could not find the reason div ðŸ˜¢");
    }
  }
</script>

{% endblock %}
